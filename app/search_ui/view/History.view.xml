<mvc:View
    controllerName="com.sap.searchui.controller.History"
    xmlns="sap.m"
    xmlns:mvc="sap.ui.core.mvc">
    <Page title="Run History" showNavButton="true" navButtonPress=".onNavBack">
        <content>
            <Table
                id="historyTable"
                inset="false"
                items="{
                    path: '/SearchRuns',
                    sorter: { path: 'createdAt', descending: true },
                    parameters: { $expand: 'terms' } 
                }">
                <headerToolbar>
                    <Toolbar>
                        <Title text="Past Keyword Analysis Runs"/>
                        <ToolbarSpacer/>
                        <Button icon="sap-icon://refresh" press="onRefresh"/>
                    </Toolbar>
                </headerToolbar>
                <columns>
                    <Column><Text text="File Name"/></Column>
                    <Column minScreenWidth="Tablet" demandPopin="true"><Text text="Keywords"/></Column>
                    <Column minScreenWidth="Tablet" demandPopin="true"><Text text="Runtime"/></Column>
                    <Column minScreenWidth="Desktop" demandPopin="true"><Text text="Status"/></Column>
                    <Column><Text text="Run Date"/></Column>
                    <Column><Text text="Report"/></Column>
                </columns>
                <items>
                    <ColumnListItem vAlign="Middle" type="Navigation">
                        <cells>
                            <Text text="{fileName}"/>
                            <Text text="{keywordCount}"/>
                            <Text text="{= ${runtimeInSeconds} + ' seconds'}"/>
                            <ObjectStatus
                                text="{status}"
                                state="{= ${status} === 'Success' ? 'Success' : ${status} === 'Failed' ? 'Error' : 'Warning' }"/>
                            <Text text="{
                                path: 'createdAt',
                                formatter: '.formatter.formatDateTime'
                            }"/>
                            <Link 
                                text="Download" 
                                href="{reportUrl}" 
                                visible="{
                                    path: 'reportUrl',
                                    formatter: '.formatter.isReportVisible'
                                }"
                                target="_blank"
                            />
                        </cells>
                    </ColumnListItem>
                </items>
                 <dependents>
                    <Panel expandable="true" expanded="false" width="auto" class="sapUiNoContentPadding">
                        <headerToolbar>
                            <Toolbar>
                                <Title text="Processed Keywords"/>
                            </Toolbar>
                        </headerToolbar>
                        <content>
                            <List
                                items="{terms}">
                                <StandardListItem title="{keyword}" description="Excluded: {= ${excludedDomains} || 'None'}"/>
                            </List>
                        </content>
                    </Panel>
                </dependents>
            </Table>
        </content>
    </Page>
</mvc:View>